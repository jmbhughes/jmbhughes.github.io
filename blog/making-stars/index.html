<!DOCTYPE html>
<html lang="en" >

<head>
    <meta charset="UTF-8"><meta http-equiv="Content-Security-Policy"
content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;style-src 'self';frame-src https://www.youtube-nocookie.com 'self' giscus.app;connect-src 'self' jmbhughes-stats.goatcounter.com/count;script-src 'self' gc.zgo.at  giscus.app 'self'">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://jmbhughes.com/">

    
    <title>
jmbhughes • Making stars</title>

    
    
        <link rel="icon" type="image/png" href="https://jmbhughes.com/icons/favicon.ico"/>
    
    

    
    
        
            
            
                
                    <link rel="alternate" type="application/atom+xml" title="jmbhughes - Atom Feed" href="https://jmbhughes.com/atom.xml">
                
            
        
    

    
    
    
        
            <link rel="stylesheet" href="https://jmbhughes.com/custom_subset.css?h=0b9535a28bc3d5bf2321">
        
    

    
        <link rel="stylesheet" href="https://jmbhughes.com/main.css?h=045c365e19a4d50a64bb" />
        <link rel="stylesheet" href="https://jmbhughes.com/skins/mint.css?h=504215cf6bc10586b487" />

    <meta name="color-scheme" content="light dark" />
        <meta name="description" content="Create realistic looking star images using Python" />
        <meta property="og:description" content="Create realistic looking star images using Python" />

    

    <meta property="og:title" content="Making stars" />
    <meta property="og:type" content="article" />

    
<meta property="og:locale" content="en_GB" />

    <meta property="og:url" content="https:&#x2F;&#x2F;jmbhughes.com&#x2F;blog&#x2F;making-stars&#x2F;" /><meta property="og:site_name" content="jmbhughes">
        <noscript><link rel="stylesheet" href="https://jmbhughes.com/no_js.css"/></noscript>
        <script type="text/javascript" src="https://jmbhughes.com/js/initializeTheme.min.js"></script>
        <script defer src="https://jmbhughes.com/js/themeSwitcher.min.js"></script>




    
    
    <script async
    
        data-goatcounter="https://jmbhughes-stats.goatcounter.com/count"
        src="https://gc.zgo.at/count.js"
        
    ></script>
    



        <script defer src="https://jmbhughes.com/js/searchElasticlunr.min.js?h=69d4be9bc2f0a8301299"></script>

        
    
</head>


<body>
    <a href="#main-content" id="skip-link">Skip to content</a>
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href="https://jmbhughes.com/">jmbhughes</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://jmbhughes.com/archive/">blog
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://jmbhughes.com/tags/">tags
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://jmbhughes.com/about/">about
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://jmbhughes.com/news/">news
                                </a>
                            </li>
                        <li class="menu-icons-container">
                        <ul class="menu-icons-group">
                            <li class="js menu-icon">
                                <div role="button" tabindex="0" id="search-button" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" aria-label="Click or press $SHORTCUT to open search">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                                        <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                                    </svg>
                                </div>
                            </li>

                            
                            

                            <li class="theme-switcher-wrapper js"><div
        title="Toggle dark&#x2F;light mode"
        class="theme-switcher"
        tabindex="0"
        role="button"
        aria-label="Toggle dark mode"
        aria-pressed="false">
    </div><div
        title="Reset mode to default"
        class="theme-resetter arrow"
        tabindex="0"
        role="button"
        aria-hidden="true"
        aria-label="Reset mode to default">
    </div>

</li>
</ul>
                    </li>
                </ul>
            </div>
        
    </nav>
</header>

    <div class="content" id="main-content">

        
        





<main>
    <article class="h-entry">
        <h1 class="p-name article-title">
            Making stars
        </h1>
        <a class="u-url u-uid" href="https://jmbhughes.com/blog/making-stars/"></a>

        <ul class="meta"><span class="hidden p-author h-card">
<a rel="author" href="https:&#x2F;&#x2F;jmbhughes.com&#x2F;" class="u-url " title=""></a>
</span>
<li><time class="dt-published" datetime="2024-06-28">28th Jun 2024</time></li><li title="441 words"><span class='separator' aria-hidden='true'>•</span>3 min read</li><li class="tag"><span class='separator' aria-hidden='true'>•</span>Tags:&nbsp;</li><li class="tag"><a class="p-category" href="https://jmbhughes.com/tags/programming/">programming</a>,&nbsp;</li><li class="tag"><a class="p-category" href="https://jmbhughes.com/tags/python/">python</a>,&nbsp;</li><li class="tag"><a class="p-category" href="https://jmbhughes.com/tags/astronomy/">astronomy</a></li>
        </ul>
            

<div class="toc-container">
    
        <h3>Table of Contents</h3>
    

    <ul>
        
            
            
                <li><a href="https://jmbhughes.com/blog/making-stars/#why-make-stars">Why make stars?</a>
                    
                </li>
            
        
            
            
                <li><a href="https://jmbhughes.com/blog/making-stars/#making-the-first-version">Making the first version</a>
                    
                        <ul>
                            
                                
                                    <li><a href="https://jmbhughes.com/blog/making-stars/#imports-and-packages">Imports and packages</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://jmbhughes.com/blog/making-stars/#getting-a-catalog">Getting a catalog</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://jmbhughes.com/blog/making-stars/#filtering-for-relevant-stars">Filtering for relevant stars</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://jmbhughes.com/blog/making-stars/#making-the-actual-star-image">Making the actual star image</a>
                                        
                                    </li>
                                
                            
                        </ul>
                    
                </li>
            
        
            
            
                <li><a href="https://jmbhughes.com/blog/making-stars/#conlusions">Conlusions</a>
                    
                </li>
            
        
    </ul>
</div>


        
            <p class="p-summary" hidden>Create realistic looking star images using Python</p><section class="e-content body"><h2 id="why-make-stars"><a class="header-anchor no-hover-padding" href="#why-make-stars" aria-label="Anchor link for: why-make-stars"><span class="link-icon" aria-hidden="true"></span></a>
Why make stars?</h2>
<p>I want to test software I’m developing to determine pointing and disortion information.
This requires a realistic star field where the pointing and distortion are known.
The only way to get this is to make the star field yourself.</p>
<h2 id="making-the-first-version"><a class="header-anchor no-hover-padding" href="#making-the-first-version" aria-label="Anchor link for: making-the-first-version"><span class="link-icon" aria-hidden="true"></span></a>
Making the first version</h2>
<p>There will be a follow up to this article about adding a point-spread function (PSF) to the star field.
But for now, we’ll stick with Gaussian stars.</p>
<h3 id="imports-and-packages"><a class="header-anchor no-hover-padding" href="#imports-and-packages" aria-label="Anchor link for: imports-and-packages"><span class="link-icon" aria-hidden="true"></span></a>
Imports and packages</h3>
<p>We only need a few packages for this work: <code>pandas</code>, <code>numpy</code>, <code>maptlotlib</code>, <code>astropy</code>, and <code>photutils</code>.</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> pandas</span><span class="z-keyword"> as</span><span class="z-source"> pd</span></span>
<span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> numpy</span><span class="z-keyword"> as</span><span class="z-source"> np</span></span>
<span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> matplotlib</span><span class="z-punctuation">.</span><span class="z-source">pyplot</span><span class="z-keyword"> as</span><span class="z-source"> plt</span></span>
<span class="giallo-l"><span class="z-keyword">from</span><span class="z-source"> astropy</span><span class="z-punctuation">.</span><span class="z-source">wcs</span><span class="z-keyword"> import</span><span class="z-source"> WCS</span><span class="z-punctuation">,</span><span class="z-source"> NoConvergence</span></span>
<span class="giallo-l"><span class="z-keyword">from</span><span class="z-source"> astropy</span><span class="z-punctuation">.</span><span class="z-source">coordinates</span><span class="z-keyword"> import</span><span class="z-source"> SkyCoord</span></span>
<span class="giallo-l"><span class="z-keyword">from</span><span class="z-source"> astropy</span><span class="z-punctuation">.</span><span class="z-source">table</span><span class="z-keyword"> import</span><span class="z-source"> QTable</span></span>
<span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> astropy</span><span class="z-punctuation">.</span><span class="z-source">units</span><span class="z-keyword"> as</span><span class="z-source"> u</span></span>
<span class="giallo-l"><span class="z-keyword">from</span><span class="z-source"> photutils</span><span class="z-punctuation">.</span><span class="z-source">datasets</span><span class="z-keyword"> import</span><span class="z-source"> make_gaussian_sources_image</span><span class="z-punctuation">,</span><span class="z-source"> make_noise_image</span></span></code></pre><h3 id="getting-a-catalog"><a class="header-anchor no-hover-padding" href="#getting-a-catalog" aria-label="Anchor link for: getting-a-catalog"><span class="link-icon" aria-hidden="true"></span></a>
Getting a catalog</h3>
<p>To make stars in real positions, we need a catalog. We’ll use the Hipparcos catalog.</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-source">HIPPARCOS_URL</span><span class="z-keyword z-operator"> =</span><span class="z-punctuation z-definition z-string z-string"> &quot;https://cdsarc.cds.unistra.fr/ftp/cats/I/239/hip_main.dat&quot;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-storage z-type z-function z-python">def</span><span class="z-entity z-name z-function"> load_raw_hipparcos_catalog</span><span class="z-punctuation">(</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    catalog_path</span><span class="z-punctuation">:</span><span class="z-support z-type z-python"> str</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function z-parameters"> HIPPARCOS_URL</span></span>
<span class="giallo-l"><span class="z-punctuation">    ) -&gt;</span><span class="z-source"> pd</span><span class="z-punctuation">.</span><span class="z-source">DataFrame</span><span class="z-punctuation">:</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">    &quot;&quot;&quot;Download hipparcos catalog from website.</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-string">    Parameters</span></span>
<span class="giallo-l"><span class="z-string">    ----------</span></span>
<span class="giallo-l"><span class="z-string">    catalog_path : str</span></span>
<span class="giallo-l"><span class="z-string">        path to the Hipparcos catalog</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-string">    Returns</span></span>
<span class="giallo-l"><span class="z-string">    -------</span></span>
<span class="giallo-l"><span class="z-string">    pd.DataFrame</span></span>
<span class="giallo-l"><span class="z-string">        loaded catalog with selected columns</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">    &quot;&quot;&quot;</span></span>
<span class="giallo-l"><span class="z-source">    column_names</span><span class="z-keyword z-operator"> =</span><span class="z-punctuation"> (</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Catalog&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;HIP&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Proxy&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;RAhms&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;DEdms&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Vmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;VarFlag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;r_Vmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;RAdeg&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;DEdeg&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;AstroRef&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Plx&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;pmRA&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;pmDE&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_RAdeg&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_DEdeg&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_Plx&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_pmRA&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_pmDE&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;DE:RA&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Plx:RA&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Plx:DE&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;pmRA:RA&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;pmRA:DE&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;pmRA:Plx&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;pmDE:RA&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;pmDE:DE&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;pmDE:Plx&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;pmDE:pmRA&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;F1&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;F2&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;---&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;BTmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_BTmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;VTmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_VTmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;m_BTmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;B-V&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_B-V&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;r_B-V&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;V-I&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_V-I&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;r_V-I&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;CombMag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Hpmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_Hpmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Hpscat&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;o_Hpmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;m_Hpmag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Hpmax&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;HPmin&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Period&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;HvarType&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;moreVar&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;morePhoto&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;CCDM&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;n_CCDM&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Nsys&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Ncomp&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;MultFlag&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Source&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Qual&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;m_HIP&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;theta&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;rho&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_rho&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;dHp&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;e_dHp&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Survey&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Chart&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;Notes&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;HD&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;BD&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;CoD&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;CPD&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;(V-I)red&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;SpType&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">        &quot;r_SpType&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation">    )</span></span>
<span class="giallo-l"><span class="z-source">    df</span><span class="z-keyword z-operator"> =</span><span class="z-source"> pd</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">read_csv</span><span class="z-punctuation">(</span></span>
<span class="giallo-l"><span class="z-meta z-function-call z-arguments z-python">        catalog_path</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">        sep</span><span class="z-keyword z-operator">=</span><span class="z-punctuation z-definition z-string z-string">&quot;|&quot;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">        names</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">column_names</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">        usecols</span><span class="z-keyword z-operator">=</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string z-string">&quot;HIP&quot;</span><span class="z-punctuation">,</span><span class="z-punctuation z-definition z-string z-string"> &quot;Vmag&quot;</span><span class="z-punctuation">,</span><span class="z-punctuation z-definition z-string z-string"> &quot;RAdeg&quot;</span><span class="z-punctuation">,</span><span class="z-punctuation z-definition z-string z-string"> &quot;DEdeg&quot;</span><span class="z-punctuation">,</span><span class="z-punctuation z-definition z-string z-string"> &quot;Plx&quot;</span><span class="z-punctuation">],</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">        na_values</span><span class="z-keyword z-operator">=</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;     &quot;</span><span class="z-punctuation">,</span><span class="z-punctuation z-definition z-string"> &quot;       &quot;</span><span class="z-punctuation">,</span><span class="z-punctuation z-definition z-string"> &quot;        &quot;</span><span class="z-punctuation">,</span><span class="z-punctuation z-definition z-string"> &quot;            &quot;</span><span class="z-punctuation">],</span></span>
<span class="giallo-l"><span class="z-punctuation">    )</span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">    df</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">distance</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> =</span><span class="z-constant z-numeric"> 1000</span><span class="z-keyword z-operator"> /</span><span class="z-meta z-indexed-name z-python"> df</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">Plx</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"><span class="z-source">    df</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-indexed-name z-python"> df</span><span class="z-punctuation">[</span><span class="z-meta z-indexed-name z-python">df</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">distance</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> &gt;</span><span class="z-constant z-numeric"> 0</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    return</span><span class="z-source"> df</span><span class="z-punctuation">.</span><span class="z-meta z-indexed-name z-python">iloc</span><span class="z-punctuation">[</span><span class="z-meta z-item-access z-python">np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">argsort</span><span class="z-punctuation">(</span><span class="z-meta z-indexed-name z-python">df</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">Vmag</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation">])]</span></span></code></pre>
<p>I recommend saving this as a CSV file and then opening it as needed instead of downloading it every time.</p>
<h3 id="filtering-for-relevant-stars"><a class="header-anchor no-hover-padding" href="#filtering-for-relevant-stars" aria-label="Anchor link for: filtering-for-relevant-stars"><span class="link-icon" aria-hidden="true"></span></a>
Filtering for relevant stars</h3>
<p>There are a lot of stars in this catalog. We may only want to show up to a certain magnitude.
Filtering on Pandas dataframes is easy though.</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-storage z-type z-function z-python">def</span><span class="z-entity z-name z-function"> filter_for_visible_stars</span><span class="z-punctuation">(</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    catalog</span><span class="z-punctuation">:</span><span class="z-meta z-function z-parameters"> pd</span><span class="z-punctuation">.</span><span class="z-meta z-function z-parameters">DataFrame</span><span class="z-punctuation">,</span><span class="z-meta z-function z-parameters"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    dimmest_magnitude</span><span class="z-punctuation">:</span><span class="z-support z-type z-python"> float</span><span class="z-keyword z-operator"> =</span><span class="z-constant z-numeric"> 6</span></span>
<span class="giallo-l"><span class="z-punctuation">    ) -&gt;</span><span class="z-source"> pd</span><span class="z-punctuation">.</span><span class="z-source">DataFrame</span><span class="z-punctuation">:</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">    &quot;&quot;&quot;Filters to only include stars brighter than a given magnitude</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-string">    Parameters</span></span>
<span class="giallo-l"><span class="z-string">    ----------</span></span>
<span class="giallo-l"><span class="z-string">    catalog : pd.DataFrame</span></span>
<span class="giallo-l"><span class="z-string">        a catalog data frame</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-string">    dimmest_magnitude : float</span></span>
<span class="giallo-l"><span class="z-string">        the dimmest magnitude to keep</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-string">    Returns</span></span>
<span class="giallo-l"><span class="z-string">    -------</span></span>
<span class="giallo-l"><span class="z-string">    pd.DataFrame</span></span>
<span class="giallo-l"><span class="z-string">        a catalog with stars dimmer than the `dimmest_magnitude` removed</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">    &quot;&quot;&quot;</span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    return</span><span class="z-meta z-indexed-name z-python"> catalog</span><span class="z-punctuation">[</span><span class="z-meta z-indexed-name z-python">catalog</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">Vmag</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> &lt;</span><span class="z-meta z-item-access z-python"> dimmest_magnitude</span><span class="z-punctuation">]</span></span></code></pre>
<p>In addition, not all the stars will be visible in our image.
A world coordinate system or WCS describes where an image is in the sky.
We’ll use it to determine the pixel coordinates of each star and then throw away those outside the frame.</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-storage z-type z-function z-python">def</span><span class="z-entity z-name z-function"> find_catalog_in_image</span><span class="z-punctuation">(</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    catalog</span><span class="z-punctuation">:</span><span class="z-meta z-function z-parameters"> pd</span><span class="z-punctuation">.</span><span class="z-meta z-function z-parameters">DataFrame</span><span class="z-punctuation">,</span><span class="z-meta z-function z-parameters"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    wcs</span><span class="z-punctuation">:</span><span class="z-meta z-function z-parameters"> WCS</span><span class="z-punctuation">,</span><span class="z-meta z-function z-parameters"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    image_shape</span><span class="z-punctuation">: (</span><span class="z-support z-type z-python">int</span><span class="z-punctuation">,</span><span class="z-support z-type z-python"> int</span><span class="z-punctuation">),</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    mode</span><span class="z-punctuation">:</span><span class="z-support z-type z-python"> str</span><span class="z-keyword z-operator"> =</span><span class="z-punctuation z-definition z-string z-string"> &quot;all&quot;</span></span>
<span class="giallo-l"><span class="z-punctuation">    ) -&gt;</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-source">ndarray</span><span class="z-punctuation">:</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">    &quot;&quot;&quot;Using the provided WCS converts the RA/DEC catalog into pixel coordinates</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-string">    Parameters</span></span>
<span class="giallo-l"><span class="z-string">    ----------</span></span>
<span class="giallo-l"><span class="z-string">    catalog : pd.DataFrame</span></span>
<span class="giallo-l"><span class="z-string">        a catalog dataframe</span></span>
<span class="giallo-l"><span class="z-string">    wcs : WCS</span></span>
<span class="giallo-l"><span class="z-string">        the world coordinate system of a given image</span></span>
<span class="giallo-l"><span class="z-string">    image_shape: (int, int)</span></span>
<span class="giallo-l"><span class="z-string">        the shape of the image array associated with the WCS, </span></span>
<span class="giallo-l"><span class="z-string">        used to only consider stars with coordinates in image</span></span>
<span class="giallo-l"><span class="z-string">    mode : str</span></span>
<span class="giallo-l"><span class="z-string">        either &quot;all&quot; or &quot;wcs&quot;,</span></span>
<span class="giallo-l"><span class="z-string">        see</span></span>
<span class="giallo-l"><span class="z-string">        &lt;https://docs.astropy.org/en/stable/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord.to_pixel&gt;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-string">    Returns</span></span>
<span class="giallo-l"><span class="z-string">    -------</span></span>
<span class="giallo-l"><span class="z-string">    np.ndarray</span></span>
<span class="giallo-l"><span class="z-string">        pixel coordinates of stars in catalog that are present in the image</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string">    &quot;&quot;&quot;</span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    try</span><span class="z-punctuation">:</span></span>
<span class="giallo-l"><span class="z-source">        xs</span><span class="z-punctuation">,</span><span class="z-source"> ys</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> SkyCoord</span><span class="z-punctuation">(</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">            ra</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">array</span><span class="z-punctuation">(</span><span class="z-meta z-indexed-name z-python">catalog</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">RAdeg</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation">])</span><span class="z-keyword z-operator"> *</span><span class="z-meta z-function-call z-arguments z-python"> u</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-arguments z-python">degree</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">            dec</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">array</span><span class="z-punctuation">(</span><span class="z-meta z-indexed-name z-python">catalog</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">DEdeg</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation">])</span><span class="z-keyword z-operator"> *</span><span class="z-meta z-function-call z-arguments z-python"> u</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-arguments z-python">degree</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">            distance</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">array</span><span class="z-punctuation">(</span><span class="z-meta z-indexed-name z-python">catalog</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">distance</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation">])</span><span class="z-keyword z-operator"> *</span><span class="z-meta z-function-call z-arguments z-python"> u</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-arguments z-python">parsec</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-punctuation">        ).</span><span class="z-meta z-function-call z-python">to_pixel</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">wcs</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> mode</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">mode</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    except</span><span class="z-source"> NoConvergence</span><span class="z-keyword z-control z-flow z-python"> as</span><span class="z-source"> e</span><span class="z-punctuation">:</span></span>
<span class="giallo-l"><span class="z-source">        xs</span><span class="z-punctuation">,</span><span class="z-source"> ys</span><span class="z-keyword z-operator"> =</span><span class="z-source"> e</span><span class="z-punctuation">.</span><span class="z-meta z-indexed-name z-python">best_solution</span><span class="z-punctuation">[:,</span><span class="z-constant z-numeric"> 0</span><span class="z-punctuation">],</span><span class="z-source"> e</span><span class="z-punctuation">.</span><span class="z-meta z-indexed-name z-python">best_solution</span><span class="z-punctuation">[:,</span><span class="z-constant z-numeric"> 1</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"><span class="z-source">    bounds_mask</span><span class="z-keyword z-operator"> =</span><span class="z-punctuation"> (</span><span class="z-constant z-numeric">0</span><span class="z-keyword z-operator"> &lt;=</span><span class="z-source"> xs</span><span class="z-punctuation">)</span><span class="z-keyword z-operator"> *</span><span class="z-punctuation"> (</span><span class="z-source">xs</span><span class="z-keyword z-operator"> &lt;</span><span class="z-meta z-indexed-name z-python"> image_shape</span><span class="z-punctuation">[</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">])</span><span class="z-keyword z-operator"> *</span><span class="z-punctuation"> (</span><span class="z-constant z-numeric">0</span><span class="z-keyword z-operator"> &lt;=</span><span class="z-source"> ys</span><span class="z-punctuation">)</span><span class="z-keyword z-operator"> *</span><span class="z-punctuation"> (</span><span class="z-source">ys</span><span class="z-keyword z-operator"> &lt;</span><span class="z-meta z-indexed-name z-python"> image_shape</span><span class="z-punctuation">[</span><span class="z-constant z-numeric">1</span><span class="z-punctuation">])</span></span>
<span class="giallo-l"><span class="z-source">    reduced_catalog</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-indexed-name z-python"> catalog</span><span class="z-punctuation">[</span><span class="z-meta z-item-access z-python">bounds_mask</span><span class="z-punctuation">].</span><span class="z-meta z-function-call z-python">copy</span><span class="z-punctuation">()</span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">    reduced_catalog</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-string">x_pix</span><span class="z-punctuation z-definition z-string">&quot;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-indexed-name z-python"> xs</span><span class="z-punctuation">[</span><span class="z-meta z-item-access z-python">bounds_mask</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">    reduced_catalog</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">y_pix</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-indexed-name z-python"> ys</span><span class="z-punctuation">[</span><span class="z-meta z-item-access z-python">bounds_mask</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    return</span><span class="z-source"> reduced_catalog</span></span></code></pre><h3 id="making-the-actual-star-image"><a class="header-anchor no-hover-padding" href="#making-the-actual-star-image" aria-label="Anchor link for: making-the-actual-star-image"><span class="link-icon" aria-hidden="true"></span></a>
Making the actual star image</h3>
<p>Finally, we can write a straightforward function to make a star field.
It’ll use all our other work until now.
We provide it with a <code>wcs</code>, the dimensions of an image (<code>img_shape</code>), and the full-width-half-maximum (<code>fwhm</code>) of our Gaussian PSF for stars.</p>
<p>There are a few other helpful parameters here too.
For example, <code>mag_set</code> and <code>flux_set</code> work together to scale the star brightnesses.
If <code>mag_set=0</code> and <code>flux_set=500_000</code> then stars with magnitude 0 in the catalo will have a flux value of <code>500_000</code>.
All other magnitude stars are scaled accordingly.</p>
<p>We also sometimes want to add noise. We can currently add a Gaussian noise with mean of <code>noise_mean</code> and standard deviation of <code>noise_std</code>.
If these parameters are set to None, then no noise is added.</p>
<p>Finally, we can control the <code>dimmest_magnitude</code> to limit what magnitude stars are shown. The more stars you show, the slower the code is.</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-storage z-type z-function z-python">def</span><span class="z-entity z-name z-function"> simulate_star_image</span><span class="z-punctuation">(</span><span class="z-variable z-parameter">wcs</span><span class="z-punctuation">,</span><span class="z-meta z-function z-parameters"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                        img_shape</span><span class="z-punctuation">,</span><span class="z-meta z-function z-parameters"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                        fwhm</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                        wcs_mode</span><span class="z-punctuation">:</span><span class="z-support z-type z-python"> str</span><span class="z-keyword z-operator"> =</span><span class="z-punctuation z-definition z-string z-string"> &#39;all&#39;</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                        mag_set</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                        flux_set</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">500_000</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                        noise_mean</span><span class="z-punctuation">:</span><span class="z-support z-type z-python"> float</span><span class="z-keyword z-operator"> |</span><span class="z-constant z-language z-python"> None</span><span class="z-keyword z-operator"> =</span><span class="z-constant z-numeric"> 25.0</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                        noise_std</span><span class="z-punctuation">:</span><span class="z-support z-type z-python"> float</span><span class="z-keyword z-operator"> |</span><span class="z-constant z-language z-python"> None</span><span class="z-keyword z-operator"> =</span><span class="z-constant z-numeric"> 5.0</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                        dimmest_magnitude</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">8</span><span class="z-punctuation">):</span></span>
<span class="giallo-l"><span class="z-source">    sigma</span><span class="z-keyword z-operator"> =</span><span class="z-source"> fwhm</span><span class="z-keyword z-operator"> /</span><span class="z-constant z-numeric"> 2.355</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">    catalog</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> load_raw_hipparcos_catalog</span><span class="z-punctuation">()</span></span>
<span class="giallo-l"><span class="z-source">    filtered_catalog</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> filter_for_visible_stars</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">catalog</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                                                dimmest_magnitude</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">dimmest_magnitude</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">    stars</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> find_catalog_in_image</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">filtered_catalog</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-meta z-function-call z-arguments z-python">                                  wcs</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-meta z-function-call z-arguments z-python">                                  img_shape</span><span class="z-punctuation">,</span></span>
<span class="giallo-l"><span class="z-variable z-parameter">                                  mode</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">wcs_mode</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">    star_mags</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-indexed-name z-python"> stars</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">Vmag</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">    sources</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> QTable</span><span class="z-punctuation">()</span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">    sources</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">x_mean</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-indexed-name z-python"> stars</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">x_pix</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">    sources</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">y_mean</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-indexed-name z-python"> stars</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">y_pix</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">    sources</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">x_stddev</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">ones</span><span class="z-punctuation">(</span><span class="z-support z-function z-builtin z-python">len</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">stars</span><span class="z-punctuation">))</span><span class="z-keyword z-operator">*</span><span class="z-source">sigma</span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">    sources</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">y_stddev</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">ones</span><span class="z-punctuation">(</span><span class="z-support z-function z-builtin z-python">len</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">stars</span><span class="z-punctuation">))</span><span class="z-keyword z-operator">*</span><span class="z-source">sigma</span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">    sources</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">flux</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> =</span><span class="z-source"> flux_set</span><span class="z-keyword z-operator"> *</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">power</span><span class="z-punctuation">(</span><span class="z-constant z-numeric">10</span><span class="z-punctuation">,</span><span class="z-keyword z-operator"> -</span><span class="z-constant z-numeric">0.4</span><span class="z-keyword z-operator">*</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">star_mags</span><span class="z-keyword z-operator"> -</span><span class="z-meta z-function-call z-arguments z-python"> mag_set</span><span class="z-punctuation">))</span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">    sources</span><span class="z-punctuation">[</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-string">theta</span><span class="z-punctuation z-definition z-string">&#39;</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">zeros</span><span class="z-punctuation">(</span><span class="z-support z-function z-builtin z-python">len</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">stars</span><span class="z-punctuation">))</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">    fake_image</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> make_gaussian_sources_image</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">img_shape</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> sources</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    if</span><span class="z-source"> noise_mean</span><span class="z-keyword z-operator z-logical z-python"> is not</span><span class="z-constant z-language z-python"> None</span><span class="z-keyword z-operator z-logical z-python"> and</span><span class="z-source"> noise_std</span><span class="z-keyword z-operator z-logical z-python"> is not</span><span class="z-constant z-language z-python"> None</span><span class="z-punctuation">:</span><span class="z-punctuation z-definition z-comment z-comment">  # we only add noise if it&#39;s specified</span></span>
<span class="giallo-l"><span class="z-source">        fake_image</span><span class="z-keyword z-operator"> +=</span><span class="z-meta z-function-call z-python"> make_noise_image</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">img_shape</span><span class="z-punctuation">,</span><span class="z-punctuation z-definition z-string z-string"> &#39;gaussian&#39;</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> mean</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">noise_mean</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> stddev</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">noise_std</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    return</span><span class="z-source"> fake_image</span><span class="z-punctuation">,</span><span class="z-source"> sources</span></span></code></pre>
<p>So let’s run it!</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-source">m</span><span class="z-keyword z-operator"> =</span><span class="z-constant z-numeric"> 1</span></span>
<span class="giallo-l"><span class="z-source">shape</span><span class="z-keyword z-operator"> =</span><span class="z-punctuation"> (</span><span class="z-constant z-numeric">1024</span><span class="z-keyword z-operator">*</span><span class="z-source">m</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 1024</span><span class="z-keyword z-operator">*</span><span class="z-source">m</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">w</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> WCS</span><span class="z-punctuation">(</span><span class="z-variable z-parameter">naxis</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">2</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">w</span><span class="z-punctuation">.</span><span class="z-source">wcs</span><span class="z-punctuation">.</span><span class="z-source">crpix</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-indexed-name z-python"> shape</span><span class="z-punctuation">[</span><span class="z-constant z-numeric">1</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> /</span><span class="z-constant z-numeric"> 2</span><span class="z-keyword z-operator"> -</span><span class="z-constant z-numeric"> 0.5</span><span class="z-punctuation">,</span><span class="z-meta z-indexed-name z-python"> shape</span><span class="z-punctuation">[</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">]</span><span class="z-keyword z-operator"> /</span><span class="z-constant z-numeric"> 2</span><span class="z-keyword z-operator"> -</span><span class="z-constant z-numeric"> 0.5</span></span>
<span class="giallo-l"><span class="z-source">w</span><span class="z-punctuation">.</span><span class="z-source">wcs</span><span class="z-punctuation">.</span><span class="z-source">crval</span><span class="z-keyword z-operator"> =</span><span class="z-constant z-numeric"> 0</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 0</span></span>
<span class="giallo-l"><span class="z-source">w</span><span class="z-punctuation">.</span><span class="z-source">wcs</span><span class="z-punctuation">.</span><span class="z-source">cdelt</span><span class="z-keyword z-operator"> =</span><span class="z-constant z-numeric"> 0.0225</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 0.0225</span></span>
<span class="giallo-l"><span class="z-source">w</span><span class="z-punctuation">.</span><span class="z-source">wcs</span><span class="z-punctuation">.</span><span class="z-source">ctype</span><span class="z-keyword z-operator"> =</span><span class="z-punctuation z-definition z-string z-string"> &#39;RA---ARC&#39;</span><span class="z-punctuation">,</span><span class="z-punctuation z-definition z-string z-string"> &#39;DEC--ARC&#39;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">img</span><span class="z-punctuation">,</span><span class="z-source"> stars</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> simulate_star_image</span><span class="z-punctuation">(</span></span>
<span class="giallo-l"><span class="z-meta z-function-call z-arguments z-python">    w</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-meta z-function-call z-arguments z-python">    shape</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    fwhm</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">3</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    dimmest_magnitude</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">12</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    noise_mean</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">10</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    noise_std</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">5</span><span class="z-punctuation">)</span></span></code></pre>
<p>And visualize it.</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-source">fig</span><span class="z-punctuation">,</span><span class="z-source"> ax</span><span class="z-keyword z-operator"> =</span><span class="z-source"> plt</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">subplots</span><span class="z-punctuation">()</span></span>
<span class="giallo-l"><span class="z-source">ax</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">imshow</span><span class="z-punctuation">(</span></span>
<span class="giallo-l"><span class="z-meta z-function-call z-arguments z-python">    img</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    vmin</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    vmax</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">100</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    cmap</span><span class="z-keyword z-operator">=</span><span class="z-punctuation z-definition z-string z-string">&#39;Greys_r&#39;</span></span>
<span class="giallo-l"><span class="z-punctuation">    )</span></span>
<span class="giallo-l"><span class="z-source">ax</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">set_axis_off</span><span class="z-punctuation">()</span></span>
<span class="giallo-l"><span class="z-source">fig</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">savefig</span><span class="z-punctuation">(</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-string z-string">    &quot;first.png&quot;</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    bbox_inches</span><span class="z-keyword z-operator">=</span><span class="z-punctuation z-definition z-string z-string">&#39;tight&#39;</span></span>
<span class="giallo-l"><span class="z-punctuation">    )</span></span></code></pre>
<p><img src="https://jmbhughes.com/blog/making-stars/first.png" alt="first star image" /></p>
<p>Note that our WCS here is rather simple, but we could have added a distortion model too and that would’ve been applied.
Be careful to set <code>wcs_mode=all</code> in that case.</p>
<h2 id="conlusions"><a class="header-anchor no-hover-padding" href="#conlusions" aria-label="Anchor link for: conlusions"><span class="link-icon" aria-hidden="true"></span></a>
Conlusions</h2>
<p>This makes a rather convincing initial star field. But it lacks shot noise, a complex PSF, and other effects that we may want to simulate.</p>
<p>In the follow up to this article, we’ll add those.</p>

        </section>
        
        

        
            
            
            

            
                
                
            
        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
        
            

<div id="comments" class="comments"


    data-repo="welpo&#x2F;tabi-comments"
    data-repo-id="R_kgDOG3bviQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOG3bvic4CjCSq"
    
        data-mapping="specific"
        data-term="making-stars"
    
    data-strict="1"
    data-reactions-enabled="1"
    
        data-input-position="bottom"
    
    data-light-theme="noborder_light"
    data-dark-theme="noborder_dark"
    
        data-lang="en"
    
    data-lazy-loading="true"
    >




    <script src="https://jmbhughes.com/js/giscus.min.js" async></script>


<noscript>You need JavaScript to view the comments.</noscript>
</div>

        </article>
</main>

    <div id="button-container">
        
        
            <div id="toc-floating-container">
                <input type="checkbox" id="toc-toggle" class="toggle"/>
                <label for="toc-toggle" id="toc-button" class="button" title="Toggle Table of Contents">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg>
                </label>
                <div class="toc-content">
                    

<div class="toc-container">
    

    <ul>
        
            
            
                <li><a href="https://jmbhughes.com/blog/making-stars/#why-make-stars">Why make stars?</a>
                    
                </li>
            
        
            
            
                <li><a href="https://jmbhughes.com/blog/making-stars/#making-the-first-version">Making the first version</a>
                    
                        <ul>
                            
                                
                                    <li><a href="https://jmbhughes.com/blog/making-stars/#imports-and-packages">Imports and packages</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://jmbhughes.com/blog/making-stars/#getting-a-catalog">Getting a catalog</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://jmbhughes.com/blog/making-stars/#filtering-for-relevant-stars">Filtering for relevant stars</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://jmbhughes.com/blog/making-stars/#making-the-actual-star-image">Making the actual star image</a>
                                        
                                    </li>
                                
                            
                        </ul>
                    
                </li>
            
        
            
            
                <li><a href="https://jmbhughes.com/blog/making-stars/#conlusions">Conlusions</a>
                    
                </li>
            
        
    </ul>
</div>


                </div>
            </div>
        

        
        <a href="#comments" id="comments-button" class="no-hover-padding" title="Go to the comments section">
                <svg viewBox="0 0 20 20" fill="currentColor"><path d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" fill-rule="evenodd"/></svg>
            </a>
        

        
        <a href="#" id="top-button" class="no-hover-padding" title="Go to the top of the page">
            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg>
        </a>
    </div>


<span id="copy-success" class="hidden">
        Copied!
    </span>
    <span id="copy-init" class="hidden">
        Copy code to clipboard
    </span>
    <script defer src="https://jmbhughes.com/js/copyCodeToClipboard.min.js"></script>


    </div>
    <footer>
    <section>
        <nav class="socials nav-navs"><ul><li>
                        <a class="nav-links no-hover-padding social" rel="" 

 href="https://jmbhughes.com/atom.xml">
                        <img loading="lazy" alt="feed" title="feed" src="https://jmbhughes.com/social_icons/rss.svg">
                        </a>
                    </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="https://github.com/jmbhughes">
                                    <img loading="lazy" alt="github" title="github" src="https://jmbhughes.com/social_icons/github.svg">
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="https://scholar.google.com/citations?user=YjcQEIkAAAAJ&hl=en">
                                    <img loading="lazy" alt="google-scholar" title="google-scholar" src="https://jmbhughes.com/social_icons/google-scholar.svg">
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="mailto:marcus@jmbhughes.com">
                                    <img loading="lazy" alt="email" title="email" src="https://jmbhughes.com/social_icons/email.svg">
                                </a>
                            </li>
                        
                    
                </ul>
            
        </nav>

        
        <nav class="nav-navs">
        </nav>

        <div class="credits">
            <small>
                
    
    
    
    
        
    
        
    

    

    
    
    

    
    
    <p><p>© 2026 J. Marcus Hughes • Unless otherwise noted, the content in this website is available under the <a class="external" rel="external" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.</p>
</p>

                
                Powered by
                <a rel="" 

 href="https://www.getzola.org">Zola</a>
                &amp;
                <a rel="" 

 href="https://github.com/welpo/tabi">tabi</a>

                •
                    <a rel="" 

 href="https:&#x2F;&#x2F;github.com&#x2F;jmbhughes&#x2F;jmbhughes.github.io">
                        Site source
                    </a></small>
        </div>
    </section>

    <div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
    <h1 id="modalTitle" class="visually-hidden">Search</h1>
    <div id="modal-content">
        <div id="searchBar">
            <div class="search-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                </svg>
            </div>
            <input id="searchInput" role="combobox" autocomplete="off" spellcheck="false" aria-expanded="false" aria-controls="results-container" placeholder="Search…"/>
            <div id="clear-search" class="close-icon interactive-icon" tabindex="0" role="button" title="Clear search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                </svg>
            </div>
        </div>
        <div id="results-container">
            <div id="results-info"><span id="zero_results"> No results</span>
                <span id="one_results"> $NUMBER result</span>
                <span id="many_results"> $NUMBER results</span><span id="two_results"> $NUMBER results</span>
                <span id="few_results"> $NUMBER results</span>
            </div>
            <div id="results" role="listbox"></div>
        </div>
    </div>
</div>
</footer>


    
    
</body>

</html>
