<!DOCTYPE html>
<html lang="en" >

<head>
    <meta charset="UTF-8"><meta http-equiv="Content-Security-Policy"
content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;style-src 'self';frame-src https://www.youtube-nocookie.com 'self' giscus.app;connect-src 'self' jmbhughes-stats.goatcounter.com/count;script-src 'self' gc.zgo.at  giscus.app 'self'">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://jmbhughes.com/">

    
    <title>
jmbhughes • Best underestimate cubic fitting</title>

    
    
        <link rel="icon" type="image/png" href="https://jmbhughes.com/icons/favicon.ico"/>
    
    

    
    
        
            
            
                
                    <link rel="alternate" type="application/atom+xml" title="jmbhughes - Atom Feed" href="https://jmbhughes.com/atom.xml">
                
            
        
    

    
    
    
        
            <link rel="stylesheet" href="https://jmbhughes.com/custom_subset.css?h=0b9535a28bc3d5bf2321">
        
    

    
        <link rel="stylesheet" href="https://jmbhughes.com/main.css?h=045c365e19a4d50a64bb" />
        <link rel="stylesheet" href="https://jmbhughes.com/skins/mint.css?h=504215cf6bc10586b487" />

    <meta name="color-scheme" content="light dark" />
        <meta name="description" content="Use quadratic programming to fit a cubic polynomial below a curve" />
        <meta property="og:description" content="Use quadratic programming to fit a cubic polynomial below a curve" />

    

    <meta property="og:title" content="Best underestimate cubic fitting" />
    <meta property="og:type" content="article" />

    
<meta property="og:locale" content="en_GB" />

    <meta property="og:url" content="https:&#x2F;&#x2F;jmbhughes.com&#x2F;blog&#x2F;fit-cubic&#x2F;" /><meta property="og:site_name" content="jmbhughes">
        <noscript><link rel="stylesheet" href="https://jmbhughes.com/no_js.css"/></noscript>
        <script type="text/javascript" src="https://jmbhughes.com/js/initializeTheme.min.js"></script>
        <script defer src="https://jmbhughes.com/js/themeSwitcher.min.js"></script>




    
    
    <script async
    
        data-goatcounter="https://jmbhughes-stats.goatcounter.com/count"
        src="https://gc.zgo.at/count.js"
        
    ></script>
    



        <script defer src="https://jmbhughes.com/js/searchElasticlunr.min.js?h=69d4be9bc2f0a8301299"></script>

        
    
</head>


<body>
    <a href="#main-content" id="skip-link">Skip to content</a>
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href="https://jmbhughes.com/">jmbhughes</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://jmbhughes.com/archive/">blog
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://jmbhughes.com/tags/">tags
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://jmbhughes.com/about/">about
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://jmbhughes.com/news/">news
                                </a>
                            </li>
                        <li class="menu-icons-container">
                        <ul class="menu-icons-group">
                            <li class="js menu-icon">
                                <div role="button" tabindex="0" id="search-button" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" aria-label="Click or press $SHORTCUT to open search">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                                        <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                                    </svg>
                                </div>
                            </li>

                            
                            

                            <li class="theme-switcher-wrapper js"><div
        title="Toggle dark&#x2F;light mode"
        class="theme-switcher"
        tabindex="0"
        role="button"
        aria-label="Toggle dark mode"
        aria-pressed="false">
    </div><div
        title="Reset mode to default"
        class="theme-resetter arrow"
        tabindex="0"
        role="button"
        aria-hidden="true"
        aria-label="Reset mode to default">
    </div>

</li>
</ul>
                    </li>
                </ul>
            </div>
        
    </nav>
</header>

    <div class="content" id="main-content">

        
        





<main>
    <article class="h-entry">
        <h1 class="p-name article-title">
            Best underestimate cubic fitting
        </h1>
        <a class="u-url u-uid" href="https://jmbhughes.com/blog/fit-cubic/"></a>

        <ul class="meta"><span class="hidden p-author h-card">
<a rel="author" href="https:&#x2F;&#x2F;jmbhughes.com&#x2F;" class="u-url " title=""></a>
</span>
<li><time class="dt-published" datetime="2024-10-21">21st Oct 2024</time></li><li title="297 words"><span class='separator' aria-hidden='true'>•</span>2 min read</li><li class="tag"><span class='separator' aria-hidden='true'>•</span>Tags:&nbsp;</li><li class="tag"><a class="p-category" href="https://jmbhughes.com/tags/programming/">programming</a>,&nbsp;</li><li class="tag"><a class="p-category" href="https://jmbhughes.com/tags/python/">python</a>,&nbsp;</li><li class="tag"><a class="p-category" href="https://jmbhughes.com/tags/math/">math</a></li>
        </ul>
            <p class="p-summary" hidden>Use quadratic programming to fit a cubic polynomial below a curve</p><section class="e-content body"><p>I was recently confronted with a problem: Given some curve or collection of data points, determine the polynomial that fits closest to the data but lies completely below it.</p>
<p>The solution I came up with: Use quadratic programming!</p>
<p>Quadratic programming is the mathematical process of solving optimization problems involving quadratic functions and linear constraints. In particular, they come in the form:</p>
<p>$$
\textrm{minimize } \frac{1}{2} x^T Q x + c^T x \
\textrm{ subject to } Ax \preceq b
$$</p>
<p>If you think about least squares, you can <a class="external" rel="external" href="https://scaron.info/blog/conversion-from-least-squares-to-quadratic-programming.html">convert least squares to a quadratic programming problem</a>. This allows us to add constraints, namely the constraint that our solution must lie below the curve.</p>
<p>After we formalize the problem and write some code to use an off-the-shelf quadratic program solver, in this case <code>quadprog</code>, we have a solution right away.</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> quadprog</span></span>
<span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> numpy</span><span class="z-keyword"> as</span><span class="z-source"> np</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-storage z-type z-function z-python">def</span><span class="z-entity z-name z-function"> fit_cubic</span><span class="z-punctuation">(</span><span class="z-variable z-parameter">x</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> y</span><span class="z-punctuation">):</span><span class="z-source">    </span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment z-comment">    # use different powers for a different degree polynomial</span></span>
<span class="giallo-l"><span class="z-source">    A</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-indexed-name z-python">c_</span><span class="z-punctuation">[</span><span class="z-meta z-item-access z-python">np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">power</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 3</span><span class="z-punctuation">),</span><span class="z-meta z-item-access z-python"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">square</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">),</span><span class="z-meta z-item-access z-python"> x</span><span class="z-punctuation">,</span><span class="z-meta z-item-access z-python"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">ones</span><span class="z-punctuation">(</span><span class="z-support z-function z-builtin z-python">len</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">))]</span><span class="z-source">  </span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">    G</span><span class="z-keyword z-operator"> =</span><span class="z-source"> A</span><span class="z-punctuation">.</span><span class="z-source">T</span><span class="z-keyword z-operator"> @</span><span class="z-source"> A</span></span>
<span class="giallo-l"><span class="z-source">    a</span><span class="z-keyword z-operator"> =</span><span class="z-source"> A</span><span class="z-punctuation">.</span><span class="z-source">T</span><span class="z-keyword z-operator"> @ -</span><span class="z-source">y</span></span>
<span class="giallo-l"><span class="z-source">    C</span><span class="z-keyword z-operator"> =</span><span class="z-source"> A</span><span class="z-punctuation">.</span><span class="z-source">T</span></span>
<span class="giallo-l"><span class="z-source">    b</span><span class="z-keyword z-operator"> = -</span><span class="z-source">y</span></span>
<span class="giallo-l"><span class="z-source">    coeffs</span><span class="z-keyword z-operator"> =</span><span class="z-source"> quadprog</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">solve_qp</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">G</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> a</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> C</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> b</span><span class="z-punctuation">)[</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"><span class="z-source">    </span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    return</span><span class="z-keyword z-operator"> -</span><span class="z-source">coeffs</span></span></code></pre>
<p>It’s beautifully short because we rely on <code>quadprog</code> to work the magic.</p>
<p>To test, we can simulate a curve using the function below:</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> scipy</span><span class="z-punctuation">.</span><span class="z-source">stats</span><span class="z-keyword"> as</span><span class="z-source"> ss</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-storage z-type z-function z-python">def</span><span class="z-entity z-name z-function"> random_hills</span><span class="z-punctuation">(</span><span class="z-variable z-parameter">x</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> num_hills</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> width_distribution</span><span class="z-punctuation">):</span></span>
<span class="giallo-l"><span class="z-source">    centers</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-source">random</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">uniform</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">min</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">),</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-meta z-function-call z-arguments z-python">        np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">max</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">),</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">        size</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">num_hills</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">    widths</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-source">random</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">normal</span><span class="z-punctuation">(</span><span class="z-meta z-indexed-name z-python">width_distribution</span><span class="z-punctuation">[</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">],</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-meta z-indexed-name z-python">        width_distribution</span><span class="z-punctuation">[</span><span class="z-constant z-numeric">1</span><span class="z-punctuation">],</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">        size</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">num_hills</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">    components</span><span class="z-keyword z-operator"> =</span><span class="z-punctuation"> [</span><span class="z-source">ss</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">norm</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">center</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> width</span><span class="z-punctuation">)</span><span class="z-source"> </span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">        for</span><span class="z-source"> center</span><span class="z-punctuation">,</span><span class="z-source"> width</span><span class="z-keyword z-control z-flow z-python"> in</span><span class="z-support z-function z-builtin z-python"> zip</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">centers</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> widths</span><span class="z-punctuation">)]</span></span>
<span class="giallo-l"><span class="z-source">    </span></span>
<span class="giallo-l"><span class="z-source">    weights</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-source">random</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">uniform</span><span class="z-punctuation">(</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 1</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> size</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">num_hills</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">    weights</span><span class="z-keyword z-operator"> =</span><span class="z-source"> weights</span><span class="z-keyword z-operator"> /</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">sum</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">weights</span><span class="z-punctuation">)</span><span class="z-punctuation z-definition z-comment z-comment"> # ensuring they sum to 1</span></span>
<span class="giallo-l"><span class="z-source">    </span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    return</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">nansum</span><span class="z-punctuation">([</span><span class="z-meta z-function-call z-arguments z-python">component</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">pdf</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">)</span><span class="z-keyword z-operator"> *</span><span class="z-meta z-function-call z-arguments z-python"> weight </span></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">        for</span><span class="z-meta z-function-call z-arguments z-python"> weight</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> component</span><span class="z-keyword z-control z-flow z-python"> in</span><span class="z-support z-function z-builtin z-python"> zip</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">weights</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> components</span><span class="z-punctuation">)],</span><span class="z-variable z-parameter"> axis</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">)</span></span></code></pre>
<p>It’s just building a Gaussian mixture model manually given <code>num_hills</code> Gaussians with widths drawn from the <code>width_distribution</code> over the input domain <code>x</code>.
The <code>width_distribution = (width_mean, width_standard_deviation)</code>.</p>
<p>Then, our script to solve this is:</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-punctuation z-definition z-comment z-comment"># replace with whatever curve you have</span></span>
<span class="giallo-l"><span class="z-source">x</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">linspace</span><span class="z-punctuation">(</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 30</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 100</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">y</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> random_hills</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 50</span><span class="z-punctuation">, (</span><span class="z-constant z-numeric">1</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 1.5</span><span class="z-punctuation">))</span><span class="z-keyword z-operator">*</span><span class="z-constant z-numeric">10</span><span class="z-keyword z-operator"> +</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">sin</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-keyword z-operator">/</span><span class="z-constant z-numeric">17</span><span class="z-punctuation">)</span><span class="z-source">  </span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment z-comment"># then fit!</span></span>
<span class="giallo-l"><span class="z-source">cubic_coeffs</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> fit_cubic</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> curve</span><span class="z-punctuation">)</span></span></code></pre>
<p>We can quickly visualize this with Matplotlib.</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> matplotlib</span><span class="z-punctuation">.</span><span class="z-source">pyplot</span><span class="z-keyword"> as</span><span class="z-source"> plt</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">fig</span><span class="z-punctuation">,</span><span class="z-source"> ax</span><span class="z-keyword z-operator"> =</span><span class="z-source"> plt</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">subplots</span><span class="z-punctuation">()</span></span>
<span class="giallo-l"><span class="z-source">ax</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">plot</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> y</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> label</span><span class="z-keyword z-operator">=</span><span class="z-punctuation z-definition z-string z-string">&quot;data&quot;</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">ax</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">plot</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">polyval</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">cubic_coeffs</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> x</span><span class="z-punctuation">),</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    c</span><span class="z-keyword z-operator">=</span><span class="z-punctuation z-definition z-string z-string">&#39;r&#39;</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> </span></span>
<span class="giallo-l"><span class="z-variable z-parameter">    label</span><span class="z-keyword z-operator">=</span><span class="z-punctuation z-definition z-string z-string">&quot;fitted cubic polynomial&quot;</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">fig</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">legend</span><span class="z-punctuation">()</span></span>
<span class="giallo-l"><span class="z-source">fig</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">show</span><span class="z-punctuation">()</span></span></code></pre>
<p>Then, we get something like:</p>
<p><img src="https://jmbhughes.com/blog/fit-cubic/example_clean.png" alt="example image" /></p>
<p>In my particular case, I’m working with noisy data. So there will sometimes be major outliers stemming from bad pixels in images.
My quick solution is just to throw out outliers less than three standard deviations by filtering the input $x$ and $y$.
This results in a fit like the following:</p>
<p><img src="https://jmbhughes.com/blog/fit-cubic/example_dirty.png" alt="another example image" /></p>
<p>We’re using this to build better F-corona models for PUNCH.</p>
<p>More to come on that!</p>
<p>All together, the script is:</p>
<pre class="giallo z-code"><code data-lang="python"><span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> quadprog</span></span>
<span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> numpy</span><span class="z-keyword"> as</span><span class="z-source"> np</span></span>
<span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> scipy</span><span class="z-punctuation">.</span><span class="z-source">stats</span><span class="z-keyword"> as</span><span class="z-source"> ss</span></span>
<span class="giallo-l"><span class="z-keyword">import</span><span class="z-source"> matplotlib</span><span class="z-punctuation">.</span><span class="z-source">pyplot</span><span class="z-keyword"> as</span><span class="z-source"> plt</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-storage z-type z-function z-python">def</span><span class="z-entity z-name z-function"> fit_cubic</span><span class="z-punctuation">(</span><span class="z-variable z-parameter">x</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> y</span><span class="z-punctuation">):</span></span>
<span class="giallo-l"><span class="z-punctuation z-definition z-comment z-comment">    # use different powers for a different degree polynomial</span></span>
<span class="giallo-l"><span class="z-source">    A</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-indexed-name z-python">c_</span><span class="z-punctuation">[</span><span class="z-meta z-item-access z-python">np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">power</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 3</span><span class="z-punctuation">),</span><span class="z-meta z-item-access z-python"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">square</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">),</span><span class="z-meta z-item-access z-python"> x</span><span class="z-punctuation">,</span><span class="z-meta z-item-access z-python"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">ones</span><span class="z-punctuation">(</span><span class="z-support z-function z-builtin z-python">len</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">))]</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">    y</span><span class="z-keyword z-operator"> =</span><span class="z-source"> y</span></span>
<span class="giallo-l"><span class="z-source">    G</span><span class="z-keyword z-operator"> =</span><span class="z-source"> A</span><span class="z-punctuation">.</span><span class="z-source">T</span><span class="z-keyword z-operator"> @</span><span class="z-source"> A</span></span>
<span class="giallo-l"><span class="z-source">    a</span><span class="z-keyword z-operator"> =</span><span class="z-source"> A</span><span class="z-punctuation">.</span><span class="z-source">T</span><span class="z-keyword z-operator"> @ -</span><span class="z-source">y</span></span>
<span class="giallo-l"><span class="z-source">    C</span><span class="z-keyword z-operator"> =</span><span class="z-source"> A</span><span class="z-punctuation">.</span><span class="z-source">T</span></span>
<span class="giallo-l"><span class="z-source">    b</span><span class="z-keyword z-operator"> = -</span><span class="z-source">y</span></span>
<span class="giallo-l"><span class="z-source">    coeffs</span><span class="z-keyword z-operator"> =</span><span class="z-source"> quadprog</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">solve_qp</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">G</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> a</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> C</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> b</span><span class="z-punctuation">)[</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">]</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    return</span><span class="z-keyword z-operator"> -</span><span class="z-source">coeffs</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-storage z-type z-function z-python">def</span><span class="z-entity z-name z-function"> random_hills</span><span class="z-punctuation">(</span><span class="z-variable z-parameter">x</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> num_hills</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> width_distribution</span><span class="z-punctuation">):</span></span>
<span class="giallo-l"><span class="z-source">    centers</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-source">random</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">uniform</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">min</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">),</span><span class="z-meta z-function-call z-arguments z-python"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">max</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">),</span><span class="z-variable z-parameter"> size</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">num_hills</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">    widths</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-source">random</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">normal</span><span class="z-punctuation">(</span><span class="z-meta z-indexed-name z-python">width_distribution</span><span class="z-punctuation">[</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">],</span><span class="z-meta z-indexed-name z-python"> width_distribution</span><span class="z-punctuation">[</span><span class="z-constant z-numeric">1</span><span class="z-punctuation">],</span><span class="z-variable z-parameter"> size</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">num_hills</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">    components</span><span class="z-keyword z-operator"> =</span><span class="z-punctuation"> [</span><span class="z-source">ss</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">norm</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">center</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> width</span><span class="z-punctuation">)</span><span class="z-keyword z-control z-flow z-python"> for</span><span class="z-source"> center</span><span class="z-punctuation">,</span><span class="z-source"> width</span><span class="z-keyword z-control z-flow z-python"> in</span><span class="z-support z-function z-builtin z-python"> zip</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">centers</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> widths</span><span class="z-punctuation">)]</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">    weights</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-source">random</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">uniform</span><span class="z-punctuation">(</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 1</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> size</span><span class="z-keyword z-operator">=</span><span class="z-meta z-function-call z-arguments z-python">num_hills</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">    weights</span><span class="z-keyword z-operator"> =</span><span class="z-source"> weights</span><span class="z-keyword z-operator"> /</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">sum</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">weights</span><span class="z-punctuation">)</span><span class="z-punctuation z-definition z-comment z-comment">  # ensuring they sum to 1</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">    return</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">nansum</span><span class="z-punctuation">([</span><span class="z-meta z-function-call z-arguments z-python">component</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">pdf</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">)</span><span class="z-keyword z-operator"> *</span><span class="z-meta z-function-call z-arguments z-python"> weight</span><span class="z-keyword z-control z-flow z-python"> for</span><span class="z-meta z-function-call z-arguments z-python"> weight</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> component</span><span class="z-keyword z-control z-flow z-python"> in</span><span class="z-support z-function z-builtin z-python"> zip</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">weights</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> components</span><span class="z-punctuation">)],</span><span class="z-variable z-parameter"> axis</span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-keyword z-control z-flow z-python">if</span><span class="z-support z-variable z-magic z-python"> __name__</span><span class="z-keyword z-operator"> ==</span><span class="z-punctuation z-definition z-string z-string"> &quot;__main__&quot;</span><span class="z-punctuation">:</span></span>
<span class="giallo-l"><span class="z-source">    x</span><span class="z-keyword z-operator"> =</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">linspace</span><span class="z-punctuation">(</span><span class="z-constant z-numeric">0</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 30</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 1000</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">    y</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> random_hills</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 50</span><span class="z-punctuation">, (</span><span class="z-constant z-numeric">1</span><span class="z-punctuation">,</span><span class="z-constant z-numeric"> 1.5</span><span class="z-punctuation">))</span><span class="z-keyword z-operator"> *</span><span class="z-constant z-numeric"> 10</span><span class="z-keyword z-operator"> +</span><span class="z-source"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">sin</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-keyword z-operator"> /</span><span class="z-constant z-numeric"> 17</span><span class="z-punctuation">)</span><span class="z-punctuation z-definition z-comment z-comment">  # or whatever curve you want</span></span>
<span class="giallo-l"><span class="z-source">    cubic_coeffs</span><span class="z-keyword z-operator"> =</span><span class="z-meta z-function-call z-python"> fit_cubic</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> y</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span class="z-source">    fig</span><span class="z-punctuation">,</span><span class="z-source"> ax</span><span class="z-keyword z-operator"> =</span><span class="z-source"> plt</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">subplots</span><span class="z-punctuation">()</span></span>
<span class="giallo-l"><span class="z-source">    ax</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">plot</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> y</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> label</span><span class="z-keyword z-operator">=</span><span class="z-punctuation z-definition z-string z-string">&quot;data&quot;</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">    ax</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">plot</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">x</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> np</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">polyval</span><span class="z-punctuation">(</span><span class="z-meta z-function-call z-arguments z-python">cubic_coeffs</span><span class="z-punctuation">,</span><span class="z-meta z-function-call z-arguments z-python"> x</span><span class="z-punctuation">),</span><span class="z-variable z-parameter"> c</span><span class="z-keyword z-operator">=</span><span class="z-punctuation z-definition z-string z-string">&#39;r&#39;</span><span class="z-punctuation">,</span><span class="z-variable z-parameter"> label</span><span class="z-keyword z-operator">=</span><span class="z-punctuation z-definition z-string z-string">&quot;fitted cubic polynomial&quot;</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">    ax</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">legend</span><span class="z-punctuation">()</span></span>
<span class="giallo-l"><span class="z-source">    plt</span><span class="z-punctuation">.</span><span class="z-meta z-function-call z-python">show</span><span class="z-punctuation">()</span></span></code></pre>
        </section>
        
        

        
            
            
            

            
                
                
            
        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
        
            

<div id="comments" class="comments"


    data-repo="welpo&#x2F;tabi-comments"
    data-repo-id="R_kgDOG3bviQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOG3bvic4CjCSq"
    
        data-mapping="specific"
        data-term="fit-cubic"
    
    data-strict="1"
    data-reactions-enabled="1"
    
        data-input-position="bottom"
    
    data-light-theme="noborder_light"
    data-dark-theme="noborder_dark"
    
        data-lang="en"
    
    data-lazy-loading="true"
    >




    <script src="https://jmbhughes.com/js/giscus.min.js" async></script>


<noscript>You need JavaScript to view the comments.</noscript>
</div>

        </article>
</main>

    <div id="button-container">
        
        

        
        <a href="#comments" id="comments-button" class="no-hover-padding" title="Go to the comments section">
                <svg viewBox="0 0 20 20" fill="currentColor"><path d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" fill-rule="evenodd"/></svg>
            </a>
        

        
        <a href="#" id="top-button" class="no-hover-padding" title="Go to the top of the page">
            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg>
        </a>
    </div>


<link rel="stylesheet" href="https://jmbhughes.com/katex.min.css">
    <script defer src="https://jmbhughes.com/js/katex.min.js"></script>
    <span id="copy-success" class="hidden">
        Copied!
    </span>
    <span id="copy-init" class="hidden">
        Copy code to clipboard
    </span>
    <script defer src="https://jmbhughes.com/js/copyCodeToClipboard.min.js"></script>


    </div>
    <footer>
    <section>
        <nav class="socials nav-navs"><ul><li>
                        <a class="nav-links no-hover-padding social" rel="" 

 href="https://jmbhughes.com/atom.xml">
                        <img loading="lazy" alt="feed" title="feed" src="https://jmbhughes.com/social_icons/rss.svg">
                        </a>
                    </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="https://github.com/jmbhughes">
                                    <img loading="lazy" alt="github" title="github" src="https://jmbhughes.com/social_icons/github.svg">
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="https://scholar.google.com/citations?user=YjcQEIkAAAAJ&hl=en">
                                    <img loading="lazy" alt="google-scholar" title="google-scholar" src="https://jmbhughes.com/social_icons/google-scholar.svg">
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="mailto:marcus@jmbhughes.com">
                                    <img loading="lazy" alt="email" title="email" src="https://jmbhughes.com/social_icons/email.svg">
                                </a>
                            </li>
                        
                    
                </ul>
            
        </nav>

        
        <nav class="nav-navs">
        </nav>

        <div class="credits">
            <small>
                
    
    
    
    
        
    
        
    

    

    
    
    

    
    
    <p><p>© 2026 J. Marcus Hughes • Unless otherwise noted, the content in this website is available under the <a class="external" rel="external" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.</p>
</p>

                
                Powered by
                <a rel="" 

 href="https://www.getzola.org">Zola</a>
                &amp;
                <a rel="" 

 href="https://github.com/welpo/tabi">tabi</a>

                •
                    <a rel="" 

 href="https:&#x2F;&#x2F;github.com&#x2F;jmbhughes&#x2F;jmbhughes.github.io">
                        Site source
                    </a></small>
        </div>
    </section>

    <div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
    <h1 id="modalTitle" class="visually-hidden">Search</h1>
    <div id="modal-content">
        <div id="searchBar">
            <div class="search-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                </svg>
            </div>
            <input id="searchInput" role="combobox" autocomplete="off" spellcheck="false" aria-expanded="false" aria-controls="results-container" placeholder="Search…"/>
            <div id="clear-search" class="close-icon interactive-icon" tabindex="0" role="button" title="Clear search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                </svg>
            </div>
        </div>
        <div id="results-container">
            <div id="results-info"><span id="zero_results"> No results</span>
                <span id="one_results"> $NUMBER result</span>
                <span id="many_results"> $NUMBER results</span><span id="two_results"> $NUMBER results</span>
                <span id="few_results"> $NUMBER results</span>
            </div>
            <div id="results" role="listbox"></div>
        </div>
    </div>
</div>
</footer>


    
    
</body>

</html>
